# AquaCode API

AquaCode API is designed to be the engine that connects all of AquaCodeâ€™s services.
Its purpose is simple: to provide a flexible, efficient, and extensible layer that enables AquaCode Studio to build apps without friction.

Built with:

- **NestJs**

---

## What's included

### Authentication & Sessions
- Authentication powered by BetterAuth.
- User and session management.
- Used by AquaCode Studio for initial access and credential handling.

### Auto-generated API (Schemas â†’ Endpoints)
- Endpoints dynamically generated based on the schemas defined in each projectâ€™s model.
- CRUD operations available on the corresponding collections when needed.
- Validations and types based on the generated models.

### AI Integrations
 - Direct integration with AI providers:
   - Anthropic (Claude)
   - Google (Gemini)
 - Model selection from Studio.
 - Used for generating structures, actions, and app content.

### Project Engine
 - Project content processing.
 - Management of actions, structures, and logic generated by the AI.
 - Real-time synchronization with AquaCode Studio.

### Jobs & Background Tasks
 - Redis as the queue engine.
 - **BullMQ** used to process:
   - Sandbox initialization
   - Deployments
 - Secure, parallel, and fault-tolerant execution.

### Deployments & Sandboxes
 - Integration with **Vercel** for:
   - Real-time sandbox creation
   - App deployment to production or preview
 - Plans to add more providers in the future.

### Documentation
Auto-generated API documentation is available in development mode at `/docs`.
For example: `http://localhost:3001/docs`

---

### Environment Variables

The API requires the following variables to be configured in a .env file.

### ðŸ—„ Database Configuration

```
# Database Configuration
# MongoDB is your primary database.
# Redis is used for queues, jobs, and internal tasks.
MONGO_DATABASE_URI=mongodb+srv://{user}:{password}@{host}/app # Your MongoDB cluster
REDIS_DATABASE_URI=redis://{user}:{password}@{host}:{port} # Your Redis instance

# Authentication (BetterAuth)
# Key used to sign tokens and manage sessions.
BETTER_AUTH_SECRET=aquacode_secret # Replace with a secure key in production

# LLM Providers
# You must configure at least one for AquaCode to build apps.
# You can use Anthropic (Claude) or Google (Gemini).
ANTHROPIC_API_KEY=sk-ant-...
GOOGLE_API_KEY=AIz...

# Vercel Configuration
# Required for sandboxes and automatic deployments.
VERCEL_TOKEN=kcN... # Your Vercel personal token
VERCEL_TEAM_ID=team_3re... # Your team ID

# AquaCode Configuration
# Core server configuration.
AQUA_DOMAIN=https://api.mydomain.com # Domain where the API is running
AQUA_STUDIO_DEFAULT_EMAIL=user@example.com # Initial user to access Studio, remove after initial setup
AQUA_STUDIO_DEFAULT_PASSWORD=example # Password for the initial user, remove after initial setup
```

---

## Developer Quickstart

```bash
# Install required dependencies
pnpm install
# Start the development server
pnpm run dev
```

---

## Initial Setup

Before accessing **AquaCode Studio**, you need to run the Initial Setup to create the first user account and configure the project.
Run the API in development mode and open the auto-generated documentation:

`http://localhost:3001/docs`

From there, you can either:

 1. Go directly to the Initialization endpoint:  
   `http://localhost:3001/docs#/Initialization/InitializationController_initialize`
 2. Or navigate within the documentation to the **Initialization** section, select the only available controller, and execute the request.

Click **Try it out â†’ Execute** to create the initial user.
The account will be generated with the values defined in:

```bash
AQUA_STUDIO_DEFAULT_EMAIL
AQUA_STUDIO_DEFAULT_PASSWORD
```

The request returns a response like this:

```
{
  "result": {
    "_id": "prj_01KADJ8MD4JQTCZ5QSXZYQQVPD",
    "name": "aqua-project",
    "description": "From idea to an app with AI",
    "domain": null,
    "isPlatform": true,
    "connection": "Aqua-Connection",
    "projectMetaData": {},
    "createdAt": "2025-11-19T08:04:00.048Z",
    "updatedAt": "2025-11-19T08:04:00.048Z"
  },
  "success": true,
  "errors": [],
  "messages": [
    "Platform initialization completed successfully"
  ]
}
```

Copy the project ID from result._id and set it as the `.env` value of `NEXT_PUBLIC_AQUA_PROJECT_ID` in **AquaCode Studio**.

You can now log in to **AquaCode Studio** using this account.

---

## Notes

- Currently, all sandboxes and deployments are handled via **Vercel**. More providers are planned for future versions.
- The API exposes several internal routes used by AquaCode Studio â€” not all are intended for external use.

---

## How to contribute

- Create branches based on main.
- Suggested format: `{type}/{name}`.
- Types: `feature | fix | chore`.
- Keep PRs small, clear, and focused.

---